<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Album Tracker</title>
    <script src="https://d3js.org/d3.v5.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/queue.v1.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-latest.min.js"
      type="text/javascript"
    ></script>
    <script src="https://d3js.org/d3-array.v2.min.js"></script>
    <script src="https://www.unpkg.com/@tidyjs/tidy/dist/umd/tidy.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://unpkg.com/textures@1.2.0/dist/textures.js"></script>
    <script src="scripts/functions.js"></script>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    />
  </head>
  <body>
    <div id="loader" class="loader">
      <div class="wave wave1"></div>
      <div class="wave wave2"></div>
      <div class="wave wave3"></div>
      <div class="wave wave4"></div>
      <div class="wave wave5"></div>
      <div class="space"></div>
      <div>LOADING...</div>
      <div class="space"></div>
      <div class="wave wave5"></div>
      <div class="wave wave4"></div>
      <div class="wave wave3"></div>
      <div class="wave wave2"></div>
      <div class="wave wave1"></div>
    </div>

    <main class="container">
      <section>
        <div id="overview" class="stats-container" style="height: 700px">
          <div id="overview-title" class="item stats-title"></div>
          <div
            id="overview-text"
            class="item stats-text"
            style="height: 100px"
          ></div>
          <div id="overview-listen-years" class="item radio-options"></div>
          <div id="overview-image" class="stats-image last-item">
            <script src="scripts/cumulative_albums.js"></script>
          </div>
        </div>
      </section>

      <section>
        <div id="recent" class="stats-container" style="height: 600px">
          <div id="recent-title" class="item stats-title">
            <h1>Recent Albums</h1>
          </div>
          <div id="recent-text" class="item stats-text"></div>
          <div id="recent-image" class="last-item stats-image">
            <script src="scripts/recent_albums.js"></script>
          </div>
        </div>
      </section>

      <section>
        <div id="release-year" class="stats-container" style="height: 700px">
          <div id="release-title" class="item stats-title">
            <h1>Albums by Release Year</h1>
          </div>
          <div id="release-text" class="item stats-text"></div>
          <div id="release-listen-years" class="item radio-options">
            <div>
              <input
                type="radio"
                id="all"
                name="listen-period"
                value="all"
                checked
              />
              <label for="all">All Time</label>
            </div>
            <div>
              <input type="radio" id="year" name="listen-period" value="year" />
              <label for="year">Last Year</label>
            </div>
            <div>
              <input
                type="radio"
                id="month"
                name="listen-period"
                value="month"
              />
              <label for="month">Last Month</label>
            </div>
            <div>
              <input type="radio" id="week" name="listen-period" value="week" />
              <label for="week">Last Week</label>
            </div>
          </div>

          <div id="release-image" class="last-item stats-image">
            <script src="scripts/release_year.js"></script>
          </div>
        </div>
      </section>

      <section>
        <div id="release-decade" class="stats-container">
          <div id="release-decade-title" class="item stats-title">
            <h1>Release Decade of Albums by Listen Year</h1>
          </div>
          <div id="release-decade-text" class="item stats-text"></div>
          <div
            id="release-decade-image"
            class="last-item release-decade-tile-container"
          >
            <script src="scripts/release_decade.js"></script>
          </div>
        </div>
      </section>

      <section>
        <div id="artist" class="stats-container">
          <div id="artist-title" class="item stats-title"></div>
          <div id="artist-text" class="stats-text"></div>

          <div id="legend" class="legend-show">
            <div
              class="artists-tile-container"
              style="height: 150px; overflow-y: hidden; margin-bottom: 10px"
            >
              <div class="legends-tile" id="overview-legend-div"></div>
            </div>
          </div>

          <div
            id="album-container"
            class="item album-container album-container-hide"
          >
            <div class="album-info-tiles">
              <div class="album-info-legend" id="album-info-legend"></div>
              <div class="album-artist-image"></div>
              <div class="album-artist-title"></div>
              <div class="album-artist-info"></div>
              <div class="album-artist-plays"></div>
              <div class="album-src"></div>
            </div>
          </div>

          <div
            id="artist-image"
            class="artists-tile-container"
            style="
              border-top: solid #a9a9a9 1px;
              padding-top: 10px;
              padding-bottom: 10px;
            "
          >
            <script src="scripts/artist_status.js"></script>
          </div>
        </div>
      </section>
    </main>

    <script>
      function applyStickyToAllTallContainers() {
        // Stick title and text for if larger than screen height
        const containers = document.querySelectorAll(".stats-container");
        const viewportHeight = window.innerHeight;

        containers.forEach((container) => {
          // Find the specific title and text inside THIS container
          const title = container.querySelector(".stats-title");
          const text = container.querySelector(".stats-text");

          if (!title || !text) return; // Skip if elements are missing

          // If the container is taller than the screen, make items sticky
          if (container.scrollHeight > viewportHeight) {
            title.classList.add("is-sticky");
            text.classList.add("is-sticky");
          } else {
            title.classList.remove("is-sticky");
            text.classList.remove("is-sticky");
          }
        });
      }

      // Initialize on load and refresh on window resize
      window.addEventListener("load", applyStickyToAllTallContainers);
      window.addEventListener("resize", applyStickyToAllTallContainers);

      const stickyObserver = new ResizeObserver((entries) => {
        // This runs every time a container's size changes
        applyStickyToAllTallContainers();
      });

      window.addEventListener("load", () => {
        const containers = document.querySelectorAll(".stats-container");
        containers.forEach((container) => {
          // Start observing each container for height changes
          stickyObserver.observe(container);
        });
      });
    </script>

    <!-- Remove loading screen -->
    <script>
      window.addEventListener("load", function () {
        const flag = document.getElementById("overview-legend-svg");
        const loader = document.getElementById("loader");
        setTimeout(() => {
          loader.classList.add("loader-hidden");
        }, 2500);
      });
    </script>
  </body>
</html>
